**Tools for Computer-Aided Kinetic Modeling (Part 2)**
---
**Research context**
The tools described in this repository were developed as part of the research on the mechanistic study of dynamic covalent exchanges of orthoesters with diols.

**Access to the Repository**
First, clone the repository to your local machine:
```python
git clone https://github.com/CiTOS-ULiege/KineticFitToolkit.git
```
Install the requirements:
```python
pip install -r requirements.txt
```
Finally, run the code: 
```python
python main.py
```

**Computer-Aided Kinetic Network Modeling of Orthoester Metathesis**

*Claire Muzyka,<sup>a</sup> Tom Perreira Rodrigues,<sup>a</sup> Diana V. Silva-Brenes,<sup>a,b</sup> and Jean-Christophe M. Monbaliu<sup>\*,a,c</sup>.*

a. Center for Integrated Technology and Organic Synthesis (CiTOS), MolSys Research Unit, University of Liège, Allée du Six Août 13, B-4000 Liège (Sart Tilman), Belgium 

E-mail: <jc.monbaliu@uliege.be> | <www.citos.uliege.be>

b. FloW4all Flow Technology Resource Center, University of Liège, B-4000 Liège (Sart-Tilman), Belgium

c. WEL Research Institute, Avenue Pasteur, 6, 1300 Wavre, Belgium.

This script is inspired by the existing _Chemical Kinetics_ package, which leverages the `lmfit` library to solve systems of differential equations. It extends the original functionality by incorporating quantitative performance metrics and quantile-quantile plots, providing a more robust evaluation of model accuracy. Additionally, it offers a user-friendly interface for loading data. All figures generated by the script are saved in a directory selected by the user.

### Usage Instructions:

The script can be easily used by following these four main steps:

 **a) Loading the Data**: A CSV file is required, formatted such that the first row contains the compound names and the first column (labeled "t") contains the time data. Data loading is handled through a file dialog that opens the user's file explorer, allowing them to select the appropriate CSV file. A second dialog then prompts the user to choose a destination folder where all figures will be saved.
 ```python
 # Data loading
    file_path = load()
    if not file_path:
        return
        
    save_path = select_folder_to_save()
    dataset = Dataset(file_path)
    
    # Model fitting
    fit_dataset(
        dataset=dataset,
        derivatives=derivatives,
        parameters=parameters,
        c0=c0
    )
 ```
**b) Defining the Differential Equations**: Users must formulate the differential equations to model their specific reaction kinetics. An example of the chemical system is represented as follows: 
![enter image description here](https://lh3.googleusercontent.com/d/1Q00ySi8RQUJZcVI8eOvQCjf3ZsbI1IMS)
  ```python 
  def derivatives(y, t, p):
    """System of ODEs for reaction kinetics."""
    c = {"TEOF" : y[0], "I1" : y[1], "I2" : y[2], "I5" : y[3], "P1" : y[4], "P2" : y[5], "EtOH" : y[6]}

    # calculate the differentials
    dc = dict()
    
    dc["TEOF"] =- p["k_4"]*c["TEOF"] + p["k_3"]*c["I1"]*c["EtOH"] 
    
    dc["I1"] = p["k_11"]*c["P1"]*c["EtOH"] - p["k_3"]*c["I1"]*c["EtOH"] + p["k_8"]*c["I2"]*c["EtOH"] + p["k_4"]*c["TEOF"] - p["k_5"]*c["I1"] - p["k_7"]*c["I1"]  
    
    dc["I2"] = + p["k_41"]*c["P1"]  - p["k_9"]*c["I2"] - p["k_21"]*c["I2"] - p["k_116"]*c["I2"] + p["k_7"]*c["I1"] - p["k_8"]*c["I2"]*c["EtOH"] 
    
    dc["I5"] = p["k_130"]*c["P2"] - p["k_120"]*c["I5"] + p["k_116"]*c["I2"] 
          
    dc["P1"] = - p["k_11"]*c["P1"]*c["EtOH"] - p["k_41"]*c["P1"]  + p["k_21"]*c["I2"] - p["k_18"]*c["P1"] + p["k_5"]*c["I1"] + p["k_73"]*c["P2"]*c["EtOH"] 
    
    dc["P2"] = p["k_120"]*c["I5"] + p["k_9"]*c["I2"] + p["k_18"]*c["P1"] - p["k_73"]*c["P2"]*c["EtOH"] - p["k_130"]*c["P2"]
  
    dc["EtOH"] = - p["k_11"]*c["P1"]*c["EtOH"] - p["k_3"]*c["I1"]*c["EtOH"] + p["k_9"]*c["I2"] - p["k_8"]*c["I2"]*c["EtOH"] - p["k_73"]*c["P2"]*c["EtOH"] + p["k_18"]*c["P1"] + p["k_116"]*c["I2"] + p["k_4"]*c["TEOF"] + p["k_5"]*c["I1"] + p["k_7"]*c["I1"] 
  
       
    # dict ("dc") to list ("dy") conversion
    dy = [dc["TEOF"], dc["I1"], dc["I2"], dc["I5"], dc["P1"], dc["P2"], dc["EtOH"]]

    return dy
 ```
**c) Initializing Parameters**: Initial values for rate constants and concentrations must be specified in the script using two separate dictionaries. 
```python
parameters = {
   "k_1": dict(value = 0.524, min = 0),
   "k_2": dict(value = 0.524, min = 0),
   "k_3": dict(value = 0.158, min = 0),
   "k_4": dict(value = 0.158, min = 0),
   "k_5": dict(value = 0.524, min = 0),
   "k_6": dict(value = 0.524, min = 0),
   "k_7": dict(value = 0.158, min = 0),
   "k_8": dict(value = 0.524, min = 0),
   "k_9": dict(value = 0.524, min = 0),
   "k_10": dict(value = 0.524, min = 0),
   "k_11": dict(value = 0.524, min = 0),
   "k_12": dict(value = 0.524, min = 0),
   "k_13": dict(value = 0.524, min = 0),
   "k_14": dict(value = 0.524, min = 0),
    
}
c0 = {
    "I1": dict(value = 0, vary = False),
    "I2": dict(value = 0, vary = True),
    "I5": dict(value = 0, vary = True),
    "P1": dict(value = 0, vary = True),
    "P2": dict(value = 0, vary = True),
    "EtOH": dict(value = 0, vary = True),
    "TEOF": dict(value = 0.15, vary = True),
}
  ```
**d) Results Generation and Metrics Visualization**: This section of the code automatically generates and saves key result plots—including model fits, experimental comparisons, QQ plots, and error metrics—and displays them for user review. It also prints out important statistical indicators such as BIC, and AIC, providing a comprehensive visual and quantitative assessment of the model’s performance.
```python
# Results generation
    plot_results(dataset, save_path)
    plot_experimental_and_fit_with_qq(dataset, save_path)
    plot_qq_plots(dataset, save_path)
    rmse_mae_plots(dataset, save_path)
    plt.show(block=False)
    input("Press Enter to close the figures...")

 # Displaying metrics
    print_result(dataset, save_path)
    print(f'BIC: {dataset.bic_global:.2f}')
    print(f'AIC: {dataset.aic_global:.2f}')
```

 - Model fits

![enter image description here](https://lh3.googleusercontent.com/d/1yie4vvHYKIdRdvbEiPPifH20AJMDLKPE)
 
- Coefficients of determination (R²)

![enter image description here](https://lh3.googleusercontent.com/d/1CT2iBgCVhJ40Z-YpApZGGigvozLeJzCD)

- Quantile-quantile plots (Q-Q plots)

![enter image description here](https://lh3.googleusercontent.com/d/10X38x8fKUyYv2wPROHr1fZP87vkOv80A)


- Root Mean Square Errors and Mean Absolute Errors (RMSE and MAE)

![enter image description here](https://lh3.googleusercontent.com/d/12LBeIjikGIRQ_LtaLLz3_xtoAtZutHT5)

**Funding**
This research program was funded by the University of Liege, the French Community of Belgium (Concerted Research Action CO2FLUIDICS 21/25-04). Computational resources were provided by the “Consortium des Équipements de Calcul Intensif” (CÉCI), funded by the “Fonds de la Recherche Scientifique de Belgique” (F.R.S.-FNRS) under Grant No. 2.5020.11a. 

**Acknowledgments**
This research program was funded by the University of Liege, the French Community of Belgium (Concerted Research Action CO2FLUIDICS 21/25-04). Dr. Christophe Detrembleur (Concerted Research Action CO2FLUIDICS 21/25-04, PI) and Dr. Bruno Grignard (Concerted Research Action CO2FLUIDICS 21/25-04, Collaborator) are acknowledged for their support. The authors acknowledge the “Fonds de la Recherche Scientifique (F.R.S.-FNRS) for funding. Computational resources were provided by the “Consortium des Équipements de Calcul Intensif” (CÉCI), funded by the “Fonds de la Recherche Scientifique de Belgique” (F.R.S.-FNRS) under Grant No. 2.5020.11a. The manuscript was written through contributions of all authors. All authors have given approval to the final version of the manuscript.

**Attributions**
This project is based on the  [Chemical Kinetics](https://chemical-kinetics.readthedocs.io/en/latest/)  package developed by  **Florent Boudoire**. The original Chemical Kinetics package is licensed under the MIT License.
© Copyright 2020, Florent Boudoire, Revision 70db1b3f.

Significant modifications and enhancements in this repository include:
-   Implementation of quantitative metrics and QQ-plots
-   Simplified data loading process
-   Automated figure export system

The code in this repository is licensed under the MIT License. You are free to use, modify, and distribute the code under the terms of this license.
